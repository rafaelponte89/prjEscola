{% load telefone_filters %}


{% for aluno in alunos %}
<tr class="{% if aluno.is_cancelado %}table-secondary text-muted{% endif %}">

  <td class="align-middle">
    {{ aluno.rm }}



    {% if aluno.nome|upper in nomes_duplicados %}
    <button type="button" class="btn btn-outline-primary btn-sm m-1 advertencia" value="{{ aluno.rm }}"
      data-bs-toggle="modal" data-bs-target="#resolucaoDuplicidadeModal" {% if aluno.is_cancelado %}disabled{% endif %}>
      <i class="bi bi-person-fill-exclamation"></i>
    </button>
    {% endif %}
  </td>

  <td class="align-middle">
    {% if not aluno.is_cancelado %}
    <button type="button" class="btn btn-link p-0 atualizar" value="{{ aluno.rm }}">
      {{ aluno.nome }}
    </button>
    {% else %}
    {{ aluno.nome }}

    {% endif %}
  </td>
  <td class="align-middle text-center">{{ aluno.ra }}</td>


  <td class="align-middle text-center">
    {% with matricula=aluno.matricula_ativa %}
    {% if matricula %}
    {{ matricula.classe }}
    {% else %}
    -
    {% endif %}
    {% endwith %}
  </td>

  <td class="align-middle text-center">
    {% with telefones=aluno.telefones.all %}

    {% for tel in telefones|slice:":1" %}
    <span class="badge bg-dark me-1">
      {{ tel.numero|formatar_telefone}}
    </span>
    {% endfor %}

    {% if telefones|length > 1 %}
    <div class="dropdown d-inline">
      <button class="btn btn-sm btn-outline-dark dropdown-toggle" type="button" data-bs-toggle="dropdown"
        aria-expanded="false">
        +{{ telefones|length|add:"-1" }}
      </button>

      <ul class="dropdown-menu ">
        {% for tel in telefones %}
        <li>
          <span class="dropdown-item">
            {{ tel.numero|formatar_telefone}}
          </span>
        </li>
        {% endfor %}
      </ul>
    </div>
    {% endif %}

    {% endwith %}
  </td>

  <td class="align-middle text-center">
    {% if not aluno.is_cancelado %}
    <button type="button" class="btn btn-outline-dark btn-lg historico" data-rm="{{ aluno.rm }}"
      title="Ver histórico de matrículas">
      <i class="bi bi-card-list"></i>
    </button>
    {% endif %}
  </td>


  <td class="align-middle text-center">
    {% if not aluno.is_cancelado %}
    <button type="button" class="btn btn-outline-dark btn-lg declaracao" value="{{ aluno.rm }}">
      <i class="bi bi-journal"></i>
    </button>
    {% endif %}
  </td>





  <td class="align-middle text-center">
    <span class="badge
      {% if aluno.is_ativo %}bg-success
      {% elif aluno.is_cancelado %}bg-danger
      {% elif aluno.is_arquivado %}bg-primary
      {% else %}bg-secondary{% endif %}">
      {{ aluno.get_status_display }}

    </span>
  </td>




</tr>
{% endfor %}