{% extends 'aluno/base.html' %} {% block content %}

<div class="row">
    <div class="col-12 col-md-4 d-flex justify-content-center">
        <canvas id="visperiodo" class="w-100 h-auto"></canvas>
    </div>
    <div class="col-12 col-md-6 d-flex justify-content-center">
        <canvas id="visqtdalunos" class="w-100 h-auto"></canvas>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>



<script>
   $(document).ready(() => {
    function visPeriodo() {
        $.get({
            url: "{% url 'visperiodo' %}",
            data: {
                ano: localStorage.getItem('idAno'),
            },
            success: (response) => {
                gerarGrafico(response, 'pie', '', 'visperiodo');
            },
            fail: (response) => { },
        });
    }

    function visQtdAlunos() {
        $.get({
            url: "{% url 'visqtdalunos' %}",
            data: {
                ano: localStorage.getItem('idAno'),
            },
            success: (response) => {
                gerarGrafico(response, 'line', 'Alunos', 'visqtdalunos', true);
            },
            fail: (response) => { },
        });
    }

    // Ajusta a resolução do canvas para telas de alta densidade (apenas para visQtdAlunos)
    function ajustarCanvas(identificador) {
        const canvas = document.getElementById(identificador);
        const ctx = canvas.getContext("2d");
        const ratio = window.devicePixelRatio || 1;

        canvas.width = canvas.clientWidth * ratio;
        canvas.height = canvas.clientHeight * ratio;
        ctx.scale(ratio, ratio);
    }

    // Retorna gráfico conforme configuração
    function gerarGrafico(response, tipo, titulo, identificador, ajustar = false) {
        if (ajustar) {
            ajustarCanvas(identificador); // Ajusta apenas para visQtdAlunos
        }

        const ctx = document.getElementById(identificador).getContext("2d");
        new Chart(ctx, {
            type: tipo,
            data: {
                labels: Object.keys(response),
                datasets: [{
                    label: titulo,
                    data: Object.values(response),
                    borderWidth: 1
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                ...(ajustar && { // Aplica os ajustes somente para visQtdAlunos
                    scales: {
                        x: {
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 12 : 16
                                },
                                color: "#333"
                            }
                        },
                        y: {
                            ticks: {
                                font: {
                                    size: window.innerWidth < 768 ? 12 : 16
                                },
                                color: "#333"
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            labels: {
                                font: {
                                    size: window.innerWidth < 768 ? 12 : 14
                                }
                            }
                        }
                    }
                })
            }
        });
    }

    visPeriodo();
    visQtdAlunos();
});

</script>

{% endblock content %}