{% extends 'rh/menu.html'%}
{% load static %}
{% load crispy_forms_tags %}
{% load bootstrap4 %}
{% bootstrap_css %}

{% block css %}
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />

{% endblock css %}
{% block content %}

{{form.media}}
<!DOCTYPE html>
<html>

<head>
    <title>Relatório de Faltas</title>
</head>

<body>

    <form method="get">
        <div class="container mt-2">
            <div class="row justify-content-center">
                <!-- Título do Formulário -->
                <div class="col-md-8 text-center mb-1">
                    <h1>Relatório Descritivo de Faltas</h1>
                    <h3>Filtro</h3>
                    <p>Preencha os filtros para pesquisar.</p>
                </div>
            </div>

            <div class="row justify-content-center">
                <!-- Formulário com fundo cinza e cantos arredondados -->
                <!-- Campo data inicial -->
                <div class="col-md-4 mb-1">
                    <div class="form-group">
                        {{ form.data_inicial|as_crispy_field }}
                    </div>
                </div>

                <!-- Campo data final -->
                <div class="col-md-4 mb-1">
                    <div class="form-group">
                        {{ form.data_final|as_crispy_field }}
                    </div>
                </div>



            </div>
            <div class="row justify-content-center">
                
                <div class="col-md-4 mb-1">
                    <div class="form-group">
                        {{ form.efetivo|as_crispy_field }}
                    </div>
                </div>
                 <div class="col-md-4 mb-1">
                    <div class="form-group">
                        {{ form.func_publico|as_crispy_field }}
                    </div>
                </div>

            </div>


            <div class="row justify-content-center">
                <div class="col-md-6 text-center">
                    <div class="form-group">
                        <button type="submit" class="btn btn-outline-dark btn-lg">Filtrar</button>
                        {% if dados %}
                        <a class="btn btn-outline-dark btn-lg"
                            href="{% url 'relatorio_faltas_descritivo_pdf' %}?data_inicio={{ form.cleaned_data.data_inicial|date:'Y-m-d' }}&data_fim={{ form.cleaned_data.data_final|date:'Y-m-d' }}&efetivo={{ form.cleaned_data.efetivo}}&publico={{ form.cleaned_data.func_publico}}"
                            target="_blank">PDF</a>
                        {% endif %}

                    </div>
                </div>
            </div>


    </form>

    {% if dados %}
    <div class="container mt-4">
        <div class="text-center mb-4">
            <h2 class="font-weight-bold">Relatório de Faltas</h2>
            <hr>
        </div>

        {% for pessoa_id, pessoa in dados.items %}
        <div class="card mb-3 shadow-sm">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">{{ pessoa.nome }} <small class="text-light">(Matrícula: {{ pessoa.matricula }})</small>
                </h5>
            </div>
            <div class="card-body p-2">
                {% if pessoa.faltas %}
                <ul class="list-group list-group-flush">
                    {% for falta in pessoa.faltas %}
                    <li class="list-group-item d-flex justify-content-between align-items-center">
                        <span>
                            <strong>{{ falta.data|date:'d/m/Y' }}</strong> - {{ falta.tipo }}
                        </span>
                        <span class="badge badge-danger badge-pill">{{ falta.qtd_dias }} dia(s)</span>
                    </li>
                    {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted mb-0">Nenhuma falta registrada.</p>
                {% endif %}
            </div>
        </div>
        {% endfor %}

        <div class="text-right mt-4">
            <hr>
            <h5><strong>Total de funcionários com faltas:</strong> {{ total_funcionarios }}</h5>
        </div>
    </div>
    {% endif %}

</body>

</html>

{% endblock content %}